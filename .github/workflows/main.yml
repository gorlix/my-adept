name: Build Ploopy Adept Firmware

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    container: qmkfm/qmk_cli # Uses the official QMK container

    steps:
    - name: Checkout QMK Firmware
      uses: actions/checkout@v4
      with:
        repository: qmk/qmk_firmware
        submodules: recursive
        path: qmk_firmware

    - name: Checkout User Keymap
      uses: actions/checkout@v4
      with:
        path: user_keymap

    - name: Setup Keymap Directory
      run: |
        # Create the correct directory for the Ploopy Adept
        mkdir -p qmk_firmware/keyboards/ploopyco/trackball/adept/keymaps/gorlix
        
        # Copy your config, rules, and keymap files into the QMK tree
        cp user_keymap/config.h qmk_firmware/keyboards/ploopyco/trackball/adept/keymaps/gorlix/
        cp user_keymap/keymap.c qmk_firmware/keyboards/ploopyco/trackball/adept/keymaps/gorlix/
        cp user_keymap/rules.mk qmk_firmware/keyboards/ploopyco/trackball/adept/keymaps/gorlix/

    - name: Compile Firmware
      working-directory: qmk_firmware
      # Corrected target: 'ploopyco/trackball/adept' instead of 'ploopyco/madromys'
      run: make ploopyco/trackball/adept:gorlix

    - name: Archive Firmware
      uses: actions/upload-artifact@v4
      with:
        name: ploopy_adept_firmware
        path: |
          qmk_firmware/*.uf2
          qmk_firmware/*.hex
          qmk_firmware/*.bin
